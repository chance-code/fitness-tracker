<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <title>Fitness Tracker</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00e676">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FitTrack">
  <link rel="apple-touch-icon" href="icon-192.png">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #121212;
      --surface: #1e1e1e;
      --surface-light: #2a2a2a;
      --accent: #00e676;
      --accent-dim: #00c853;
      --text: #e0e0e0;
      --text-secondary: #9e9e9e;
      --danger: #ff5252;
      --radius: 12px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* ── PIN GATE ── */
    #pin-gate {
      position: fixed; inset: 0;
      background: var(--bg);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 1000;
      padding: 20px;
      transition: opacity 0.3s, transform 0.3s;
    }
    #pin-gate.hidden {
      opacity: 0; transform: scale(1.05);
      pointer-events: none;
    }
    #pin-gate h1 {
      font-size: 1.5rem; margin-bottom: 8px;
      color: var(--accent);
    }
    #pin-gate p {
      color: var(--text-secondary); margin-bottom: 32px;
      font-size: 0.9rem;
    }
    .pin-dots {
      display: flex; gap: 16px; margin-bottom: 32px;
    }
    .pin-dot {
      width: 16px; height: 16px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      transition: background 0.15s;
    }
    .pin-dot.filled { background: var(--accent); }
    .pin-dot.error { border-color: var(--danger); background: var(--danger); }
    .pin-pad {
      display: grid; grid-template-columns: repeat(3, 72px);
      gap: 12px;
    }
    .pin-btn {
      width: 72px; height: 72px;
      border-radius: 50%;
      border: 1px solid var(--surface-light);
      background: var(--surface);
      color: var(--text);
      font-size: 1.5rem;
      font-weight: 500;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.15s;
      -webkit-user-select: none; user-select: none;
    }
    .pin-btn:active { background: var(--surface-light); }
    .pin-btn.fn { font-size: 0.85rem; border: none; background: transparent; color: var(--text-secondary); }

    /* ── APP SHELL ── */
    #app {
      display: none;
      padding: calc(var(--safe-top) + 12px) 16px calc(var(--safe-bottom) + 16px);
      max-width: 480px;
      margin: 0 auto;
    }
    #app.visible { display: block; }

    /* ── HEADER ── */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 16px;
    }
    .header h1 { font-size: 1.4rem; font-weight: 700; }
    .header h1 span { color: var(--accent); }
    .streak-badge {
      display: flex; align-items: center; gap: 6px;
      background: var(--surface);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .streak-badge .fire { color: #ff9800; }

    /* ── WEEKLY SUMMARY ── */
    .weekly-summary {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 14px 16px;
      margin-bottom: 16px;
    }
    .weekly-summary .label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .week-dots {
      display: flex; gap: 8px; margin-bottom: 8px;
    }
    .week-dot {
      flex: 1; height: 8px;
      border-radius: 4px;
      background: var(--surface-light);
      transition: background 0.3s;
    }
    .week-dot.done { background: var(--accent); }
    .week-dot.partial { background: #ff9800; }
    .week-days-labels {
      display: flex; gap: 8px;
    }
    .week-days-labels span {
      flex: 1;
      text-align: center;
      font-size: 0.65rem;
      color: var(--text-secondary);
    }

    /* ── CHATGPT LINK ── */
    .chatgpt-link {
      display: flex; align-items: center; gap: 10px;
      background: linear-gradient(135deg, #1e3a2f, #1e1e1e);
      border: 1px solid #2a4a3a;
      border-radius: var(--radius);
      padding: 14px 16px;
      margin-bottom: 16px;
      text-decoration: none;
      color: var(--text);
      transition: border-color 0.2s;
    }
    .chatgpt-link:active { border-color: var(--accent); }
    .chatgpt-link .icon {
      font-size: 1.3rem; flex-shrink: 0;
    }
    .chatgpt-link .label {
      font-size: 0.9rem; font-weight: 600;
    }
    .chatgpt-link .sublabel {
      font-size: 0.75rem; color: var(--text-secondary);
    }
    .chatgpt-link .arrow {
      margin-left: auto; color: var(--text-secondary);
    }

    /* ── DAY CARDS ── */
    .day-card {
      background: var(--surface);
      border-radius: var(--radius);
      margin-bottom: 10px;
      overflow: hidden;
      transition: border-color 0.2s;
      border: 1px solid transparent;
    }
    .day-card.today { border-color: var(--accent); }
    .day-card-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 16px;
      cursor: pointer;
      -webkit-user-select: none; user-select: none;
    }
    .day-card-header:active { background: var(--surface-light); }
    .day-info { display: flex; flex-direction: column; }
    .day-name {
      font-weight: 700; font-size: 1rem;
    }
    .day-focus {
      font-size: 0.8rem; color: var(--text-secondary); margin-top: 2px;
    }
    .day-meta {
      display: flex; align-items: center; gap: 10px;
    }
    .day-progress-ring {
      width: 32px; height: 32px;
    }
    .day-progress-ring circle {
      fill: none; stroke-width: 3;
    }
    .day-progress-ring .bg { stroke: var(--surface-light); }
    .day-progress-ring .fg {
      stroke: var(--accent);
      stroke-linecap: round;
      transition: stroke-dashoffset 0.4s;
      transform: rotate(-90deg);
      transform-origin: center;
    }
    .day-chevron {
      color: var(--text-secondary);
      transition: transform 0.3s;
      font-size: 1.1rem;
    }
    .day-card.expanded .day-chevron { transform: rotate(180deg); }

    /* ── EXERCISE LIST ── */
    .exercise-list {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease;
    }
    .day-card.expanded .exercise-list {
      max-height: 600px;
    }
    .exercise-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px 16px;
      border-top: 1px solid var(--surface-light);
    }
    .exercise-check {
      width: 24px; height: 24px;
      flex-shrink: 0;
      border-radius: 6px;
      border: 2px solid var(--text-secondary);
      background: transparent;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
      color: transparent;
      font-size: 0.9rem;
    }
    .exercise-check.checked {
      background: var(--accent);
      border-color: var(--accent);
      color: #000;
    }
    .exercise-details { flex: 1; }
    .exercise-name {
      font-size: 0.9rem; font-weight: 600;
    }
    .exercise-name.done {
      text-decoration: line-through;
      color: var(--text-secondary);
    }
    .exercise-sets {
      font-size: 0.75rem; color: var(--text-secondary); margin-top: 2px;
    }
    .exercise-video {
      width: 36px; height: 36px;
      border-radius: 8px;
      background: var(--surface-light);
      display: flex; align-items: center; justify-content: center;
      text-decoration: none;
      color: #ff4444;
      font-size: 1rem;
      flex-shrink: 0;
      transition: background 0.2s;
    }
    .exercise-video:active { background: #333; }

    /* ── DAY PROGRESS BAR ── */
    .day-progress-bar {
      height: 4px;
      background: var(--surface-light);
      margin: 0 16px 12px;
      border-radius: 2px;
      overflow: hidden;
    }
    .day-progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 2px;
      transition: width 0.4s ease;
    }
  </style>
</head>
<body>

<!-- PIN Gate -->
<div id="pin-gate">
  <h1>FitTrack</h1>
  <p>Enter your PIN</p>
  <div class="pin-dots" id="pin-dots"></div>
  <div class="pin-pad" id="pin-pad"></div>
</div>

<!-- App -->
<div id="app">
  <div class="header">
    <h1><span>Fit</span>Track</h1>
    <div class="streak-badge">
      <span class="fire">&#x1F525;</span>
      <span id="streak-count">0</span> day streak
    </div>
  </div>

  <div class="weekly-summary">
    <div class="label">This Week</div>
    <div class="week-dots" id="week-dots"></div>
    <div class="week-days-labels" id="week-labels"></div>
  </div>

  <a class="chatgpt-link" id="chatgpt-link" href="https://chat.openai.com" target="_blank" rel="noopener">
    <span class="icon">&#x1F4AC;</span>
    <div>
      <div class="label">ChatGPT Deep Research</div>
      <div class="sublabel">Open workout research</div>
    </div>
    <span class="arrow">&#x203A;</span>
  </a>

  <div id="day-cards"></div>
</div>

<script>
// ── CONFIG ──
const PIN = '1234';
const CHATGPT_URL = 'https://chatgpt.com/s/dr_69798a14ed2c8191be3a6390a6b87767';

// ── WORKOUT PLAN ──
const WORKOUT_PLAN = [
  {
    day: 'Monday',
    focus: 'Strength + Plyometrics',
    exercises: [
      { name: 'Box Jumps', sets: 3, reps: 5, video: 'https://www.youtube.com/watch?v=NBY9-kTuHEk' },
      { name: 'Lateral Bounds', sets: 3, reps: '6/side', video: 'https://www.youtube.com/watch?v=S8pVw-gGwqM' },
      { name: 'Squats', sets: 3, reps: 10, video: 'https://www.youtube.com/watch?v=aclHkVaku9U' },
      { name: 'Dumbbell Lunges', sets: 3, reps: '8/leg', video: 'https://www.youtube.com/watch?v=D7KaRcUTQeE' },
      { name: 'Pull-ups', sets: 3, reps: 'AMAP', video: 'https://www.youtube.com/watch?v=eGo4IYlbE5g' },
      { name: 'Dumbbell Bench Press', sets: 3, reps: 10, video: 'https://www.youtube.com/watch?v=VmB1G1K7v94' },
      { name: 'Plank', sets: 3, reps: '30s', video: 'https://www.youtube.com/watch?v=ASdvN_XEl_c' },
    ]
  },
  {
    day: 'Tuesday',
    focus: 'Light Recovery / Technical',
    exercises: [
      { name: 'Mobility / Dynamic Stretching', sets: 1, reps: '10 min', video: 'https://www.youtube.com/watch?v=TSIbzfcnv_8' },
      { name: 'Foam Rolling', sets: 1, reps: '10 min', video: 'https://www.youtube.com/watch?v=SxiDBPBQ1TY' },
      { name: 'Light Bike Ride', sets: 1, reps: '20 min', video: 'https://www.youtube.com/watch?v=menYU-FoHTI' },
      { name: 'Technical Ball Work (optional)', sets: 1, reps: '20 min', video: 'https://www.youtube.com/watch?v=NXB3l02pmKs' },
    ]
  },
  {
    day: 'Wednesday',
    focus: 'Speed & Agility',
    exercises: [
      { name: 'Dynamic Warm-up', sets: 1, reps: '5 min', video: 'https://www.youtube.com/watch?v=TSIbzfcnv_8' },
      { name: 'Sprint Starts (15 yd)', sets: 6, reps: 1, video: 'https://www.youtube.com/watch?v=6kPVjnkhMos' },
      { name: 'Flying Sprints (30 yd)', sets: 4, reps: 1, video: 'https://www.youtube.com/watch?v=5HLbPWfEsHQ' },
      { name: 'Zig-Zag Cone Drill', sets: 4, reps: 1, video: 'https://www.youtube.com/watch?v=NEfRMAjRDCQ' },
      { name: 'T-Drill', sets: 2, reps: 1, video: 'https://www.youtube.com/watch?v=Vy4iMBMGFGQ' },
    ]
  },
  {
    day: 'Thursday',
    focus: 'Upper Strength + Conditioning',
    exercises: [
      { name: 'Trap-bar Deadlifts', sets: 3, reps: 8, video: 'https://www.youtube.com/watch?v=r4MzxtBKyNE' },
      { name: 'Bulgarian Split Squats', sets: 3, reps: '8/leg', video: 'https://www.youtube.com/watch?v=2C-uNgKwPLE' },
      { name: 'Overhead Press', sets: 3, reps: 10, video: 'https://www.youtube.com/watch?v=QAQ64hK4Xxs' },
      { name: 'One-arm Dumbbell Rows', sets: 3, reps: '10/arm', video: 'https://www.youtube.com/watch?v=roCP6wCXPqo' },
      { name: 'Nordic Hamstring Curls', sets: 2, reps: 5, video: 'https://www.youtube.com/watch?v=WnIBnBBEveE' },
      { name: 'Side Plank', sets: 2, reps: '30s/side', video: 'https://www.youtube.com/watch?v=K2VljzCC16g' },
      { name: 'Intervals (30s run / 30s walk)', sets: 8, reps: 1, video: 'https://www.youtube.com/watch?v=W7EqEn5OPGI' },
    ]
  },
  {
    day: 'Friday',
    focus: 'Rest / Cross-Train',
    exercises: [
      { name: 'Gentle Stretching', sets: 1, reps: '15 min', video: 'https://www.youtube.com/watch?v=g_tea8ZNorA' },
      { name: 'Foam Rolling', sets: 1, reps: '10 min', video: 'https://www.youtube.com/watch?v=SxiDBPBQ1TY' },
      { name: 'Light Cross-Training (swim/bike/hoops)', sets: 1, reps: '20-30 min', video: 'https://www.youtube.com/watch?v=menYU-FoHTI' },
    ]
  },
  {
    day: 'Saturday',
    focus: 'Speed/Power + Strength',
    exercises: [
      { name: 'Bounding', sets: 3, reps: '20 yd', video: 'https://www.youtube.com/watch?v=bBLGMzPGmVo' },
      { name: 'Jump Squats', sets: 3, reps: 8, video: 'https://www.youtube.com/watch?v=A-cFYWvaHr0' },
      { name: 'Hill Sprints (20m)', sets: 6, reps: 1, video: 'https://www.youtube.com/watch?v=vMVaPWKRHF8' },
      { name: 'Medicine Ball Throws', sets: 3, reps: 6, video: 'https://www.youtube.com/watch?v=nPlNHfnUQOg' },
      { name: 'Dead Bugs (core)', sets: 3, reps: 10, video: 'https://www.youtube.com/watch?v=I5xbsA71v1A' },
      { name: 'Agility Mirror Drill', sets: 1, reps: '5 min', video: 'https://www.youtube.com/watch?v=y0WfRAlNsYM' },
    ]
  },
  {
    day: 'Sunday',
    focus: 'Rest & Recovery',
    exercises: [
      { name: 'Gentle Stretching / Yoga', sets: 1, reps: '15 min', video: 'https://www.youtube.com/watch?v=g_tea8ZNorA' },
      { name: 'Foam Rolling', sets: 1, reps: '10 min', video: 'https://www.youtube.com/watch?v=SxiDBPBQ1TY' },
    ]
  }
];

// ── HELPERS ──
const DAY_NAMES = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const DAY_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

function getWeekKey() {
  const now = new Date();
  const start = new Date(now.getFullYear(), 0, 1);
  const week = Math.ceil(((now - start) / 86400000 + start.getDay() + 1) / 7);
  return `${now.getFullYear()}-W${week}`;
}

function storageKey(dayIndex, exerciseIndex) {
  return `ft-${getWeekKey()}-${dayIndex}-${exerciseIndex}`;
}

function isChecked(dayIndex, exerciseIndex) {
  return localStorage.getItem(storageKey(dayIndex, exerciseIndex)) === '1';
}

function setChecked(dayIndex, exerciseIndex, checked) {
  if (checked) {
    localStorage.setItem(storageKey(dayIndex, exerciseIndex), '1');
  } else {
    localStorage.removeItem(storageKey(dayIndex, exerciseIndex));
  }
}

function getDayCompletion(dayIndex) {
  const exercises = WORKOUT_PLAN[dayIndex].exercises;
  let done = 0;
  for (let i = 0; i < exercises.length; i++) {
    if (isChecked(dayIndex, i)) done++;
  }
  return { done, total: exercises.length, pct: exercises.length ? done / exercises.length : 0 };
}

function getTodayPlanIndex() {
  const jsDay = new Date().getDay(); // 0=Sun
  // WORKOUT_PLAN is Mon(0)–Sun(6), JS getDay is Sun(0)–Sat(6)
  return jsDay === 0 ? 6 : jsDay - 1;
}

function getStreak() {
  let streak = 0;
  const today = new Date();
  today.setHours(0,0,0,0);
  for (let d = 0; d < 365; d++) {
    const check = new Date(today);
    check.setDate(check.getDate() - d);
    const jsDay = check.getDay();
    const planIdx = jsDay === 0 ? 6 : jsDay - 1;
    const start = new Date(check.getFullYear(), 0, 1);
    const week = Math.ceil(((check - start) / 86400000 + start.getDay() + 1) / 7);
    const wk = `${check.getFullYear()}-W${week}`;
    const exercises = WORKOUT_PLAN[planIdx].exercises;
    let allDone = exercises.length > 0;
    for (let i = 0; i < exercises.length; i++) {
      if (localStorage.getItem(`ft-${wk}-${planIdx}-${i}`) !== '1') {
        allDone = false;
        break;
      }
    }
    if (allDone) {
      streak++;
    } else {
      // If checking today and it's not done yet, skip (don't break streak)
      if (d === 0) continue;
      break;
    }
  }
  return streak;
}

// ── PIN GATE ──
(function initPin() {
  if (sessionStorage.getItem('ft-auth') === '1') {
    document.getElementById('pin-gate').classList.add('hidden');
    document.getElementById('app').classList.add('visible');
    initApp();
    return;
  }

  let entered = '';
  const dotsEl = document.getElementById('pin-dots');
  const padEl = document.getElementById('pin-pad');

  for (let i = 0; i < 4; i++) {
    const dot = document.createElement('div');
    dot.className = 'pin-dot';
    dotsEl.appendChild(dot);
  }
  const dots = dotsEl.querySelectorAll('.pin-dot');

  function updateDots() {
    dots.forEach((d, i) => {
      d.classList.toggle('filled', i < entered.length);
      d.classList.remove('error');
    });
  }

  function onDigit(digit) {
    if (entered.length >= 4) return;
    entered += digit;
    updateDots();
    if (entered.length === 4) {
      setTimeout(() => {
        if (entered === PIN) {
          sessionStorage.setItem('ft-auth', '1');
          document.getElementById('pin-gate').classList.add('hidden');
          document.getElementById('app').classList.add('visible');
          initApp();
        } else {
          dots.forEach(d => d.classList.add('error'));
          setTimeout(() => { entered = ''; updateDots(); }, 400);
        }
      }, 150);
    }
  }

  for (let i = 1; i <= 9; i++) {
    const btn = document.createElement('button');
    btn.className = 'pin-btn';
    btn.textContent = i;
    btn.addEventListener('click', () => onDigit(String(i)));
    padEl.appendChild(btn);
  }
  // bottom row: empty, 0, delete
  const empty = document.createElement('div');
  padEl.appendChild(empty);

  const zero = document.createElement('button');
  zero.className = 'pin-btn';
  zero.textContent = '0';
  zero.addEventListener('click', () => onDigit('0'));
  padEl.appendChild(zero);

  const del = document.createElement('button');
  del.className = 'pin-btn fn';
  del.innerHTML = '&#x232B;';
  del.addEventListener('click', () => {
    entered = entered.slice(0, -1);
    updateDots();
  });
  padEl.appendChild(del);
})();

// ── APP INIT ──
function initApp() {
  document.getElementById('chatgpt-link').href = CHATGPT_URL;
  renderWeekSummary();
  renderDayCards();
  updateStreak();
}

function renderWeekSummary() {
  const dotsContainer = document.getElementById('week-dots');
  const labelsContainer = document.getElementById('week-labels');
  dotsContainer.innerHTML = '';
  labelsContainer.innerHTML = '';

  // Display Mon–Sun order
  const order = [1,2,3,4,5,6,0]; // JS day indices Mon=1..Sat=6, Sun=0
  const todayPlanIdx = getTodayPlanIndex();

  for (let i = 0; i < 7; i++) {
    const comp = getDayCompletion(i);
    const dot = document.createElement('div');
    dot.className = 'week-dot';
    if (comp.pct === 1) dot.classList.add('done');
    else if (comp.pct > 0) dot.classList.add('partial');
    dotsContainer.appendChild(dot);

    const lbl = document.createElement('span');
    lbl.textContent = WORKOUT_PLAN[i].day.slice(0, 3);
    labelsContainer.appendChild(lbl);
  }
}

function renderDayCards() {
  const container = document.getElementById('day-cards');
  container.innerHTML = '';
  const todayIdx = getTodayPlanIndex();

  WORKOUT_PLAN.forEach((plan, dayIdx) => {
    const card = document.createElement('div');
    card.className = 'day-card';
    if (dayIdx === todayIdx) card.classList.add('today');

    const comp = getDayCompletion(dayIdx);
    const circumference = 2 * Math.PI * 13;
    const offset = circumference * (1 - comp.pct);

    card.innerHTML = `
      <div class="day-card-header">
        <div class="day-info">
          <div class="day-name">${plan.day}${dayIdx === todayIdx ? ' (Today)' : ''}</div>
          <div class="day-focus">${plan.focus}</div>
        </div>
        <div class="day-meta">
          <svg class="day-progress-ring" viewBox="0 0 32 32">
            <circle class="bg" cx="16" cy="16" r="13"/>
            <circle class="fg" cx="16" cy="16" r="13"
              stroke-dasharray="${circumference}"
              stroke-dashoffset="${offset}"/>
          </svg>
          <span class="day-chevron">&#x25BE;</span>
        </div>
      </div>
      <div class="exercise-list">
        <div class="day-progress-bar">
          <div class="day-progress-fill" style="width:${comp.pct * 100}%"></div>
        </div>
        ${plan.exercises.map((ex, exIdx) => {
          const checked = isChecked(dayIdx, exIdx);
          return `
            <div class="exercise-item">
              <div class="exercise-check ${checked ? 'checked' : ''}"
                   data-day="${dayIdx}" data-ex="${exIdx}"
                   role="checkbox" aria-checked="${checked}">&#x2713;</div>
              <div class="exercise-details">
                <div class="exercise-name ${checked ? 'done' : ''}">${ex.name}</div>
                <div class="exercise-sets">${ex.sets} &times; ${ex.reps}</div>
              </div>
              <a class="exercise-video" href="${ex.video}" target="_blank" rel="noopener"
                 aria-label="Watch ${ex.name} video">&#x25B6;</a>
            </div>`;
        }).join('')}
      </div>`;

    // Toggle expand
    card.querySelector('.day-card-header').addEventListener('click', () => {
      const wasExpanded = card.classList.contains('expanded');
      // Collapse all
      container.querySelectorAll('.day-card.expanded').forEach(c => c.classList.remove('expanded'));
      if (!wasExpanded) card.classList.add('expanded');
    });

    // Checkbox clicks
    card.querySelectorAll('.exercise-check').forEach(cb => {
      cb.addEventListener('click', (e) => {
        e.stopPropagation();
        const di = parseInt(cb.dataset.day);
        const ei = parseInt(cb.dataset.ex);
        const nowChecked = !isChecked(di, ei);
        setChecked(di, ei, nowChecked);

        cb.classList.toggle('checked', nowChecked);
        cb.setAttribute('aria-checked', nowChecked);
        cb.closest('.exercise-item').querySelector('.exercise-name')
          .classList.toggle('done', nowChecked);

        // Update progress
        const newComp = getDayCompletion(di);
        const circ = 2 * Math.PI * 13;
        card.querySelector('.fg').style.strokeDashoffset = circ * (1 - newComp.pct);
        card.querySelector('.day-progress-fill').style.width = `${newComp.pct * 100}%`;

        renderWeekSummary();
        updateStreak();
      });
    });

    container.appendChild(card);

    // Auto-expand today
    if (dayIdx === todayIdx) card.classList.add('expanded');
  });
}

function updateStreak() {
  document.getElementById('streak-count').textContent = getStreak();
}

// ── SERVICE WORKER ──
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>
